<h1 id="spherical-underworld">Spherical Underworld</h1>
<h2 id="making-a-spherical-mesh">Making a spherical mesh</h2>
<h2 id="solving-on-a-spherical-mesh">Solving on a spherical mesh</h2>
<p>We seek to solve Stokes Flow on the Spherical mesh without rewriting the equations in new coordinate (i.e. r, theta, phi ) Engelman et al. (1982) describe a technique for implementing boundary condition which no longer align with the x-y-z axis. We use this method within the existing code to solve on the Spherical mesh with the equation still in x-y-z</p>
<p>Consider this 2D example of how the Stokes momentum equation works for a single boundary node.</p>
<p><img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?K%5Cboldsymbol%7Bu%7D%3D%5Cboldsymbol%7Bf%7D" alt="K\boldsymbol{u}=\boldsymbol{f}" title="K\boldsymbol{u}=\boldsymbol{f}" /></p>
<p>where <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%5Cboldsymbol%7Bu%7D" alt="\boldsymbol{u}" title="\boldsymbol{u}" /> is specified in x-y. Let's take this node to be on a boundary surface that doesn't align with the x or y axis and we wish for the node to have a constraint velocity for it normal component and uncontraint for the tangential component i.e.</p>
<p><img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?u_%7Bn%7D%3D%5Cboldsymbol%7Bn%7D%5Ccdot%5Cboldsymbol%7Bu%7D%20%3D%20n_%7Bx%7Du_%7Bx%7D%20%2B%20n_%7By%7Du_%7By%7D%20%3D%20%5Cphi" alt="u_{n}=\boldsymbol{n}\cdot\boldsymbol{u} = n_{x}u_{x} + n_{y}u_{y} = \phi" title="u_{n}=\boldsymbol{n}\cdot\boldsymbol{u} = n_{x}u_{x} + n_{y}u_{y} = \phi" /></p>
<p>More generally we can rotate a given <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%28u_%7Bx%7D%2C%20u_%7By%7D%29" alt="(u_{x}, u_{y})" title="(u_{x}, u_{y})" /> into <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%28u_%7Bn%7D%2C%20u_%7Bt%7D%29" alt="(u_{n}, u_{t})" title="(u_{n}, u_{t})" /> via</p>
<p><img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%5Cboldsymbol%7B%20u%5E%7B%27%7D%7D%20%3D%20%5Cbegin%7Bbmatrix%7D%20u_%7Bn%7D%5C%5C%20u_%7Bt%7D%20%5Cend%7Bbmatrix%7D%20%3D%20%5Cbegin%7Bbmatrix%7D%20n_%7Bx%7D%20%26%20n_%7By%7D%5C%5C%20t_%7Bx%7D%20%26%20t_%7By%7D%20%5Cend%7Bbmatrix%7D%20%5Cbegin%7Bbmatrix%7D%20u_%7Bx%7D%5C%5C%20u_%7By%7D%20%5Cend%7Bbmatrix%7D%20%3D%20R%5E%7BT%7D%5Cboldsymbol%7Bu%7D" alt="\boldsymbol{ u^{&#39;}} = \begin{bmatrix} u_{n}\\ u_{t} \end{bmatrix} = \begin{bmatrix} n_{x} &amp; n_{y}\\ t_{x} &amp; t_{y} \end{bmatrix} \begin{bmatrix} u_{x}\\ u_{y} \end{bmatrix} = R^{T}\boldsymbol{u}" title="\boldsymbol{ u^{&#39;}} = \begin{bmatrix} u_{n}\\ u_{t} \end{bmatrix} = \begin{bmatrix} n_{x} &amp; n_{y}\\ t_{x} &amp; t_{y} \end{bmatrix} \begin{bmatrix} u_{x}\\ u_{y} \end{bmatrix} = R^{T}\boldsymbol{u}" /></p>
<p>Where <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?R" alt="R" title="R" /> is a rotation matrix such that <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?R%5E%7BT%7D%3DR%5E%7B-1%7D" alt="R^{T}=R^{-1}" title="R^{T}=R^{-1}" /></p>
<p>Therefore we can rewrite the l.h.s of the momentum equation with <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%5Cboldsymbol%7Bu%27%7D" alt="\boldsymbol{u&#39;}" title="\boldsymbol{u&#39;}" /></p>
<p><img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?K%5Cboldsymbol%7Bu%7D%3DKRR%5E%7BT%7D%5Cboldsymbol%7Bu%7D%3DKR%5Cboldsymbol%7Bu%27%7D" alt="K\boldsymbol{u}=KRR^{T}\boldsymbol{u}=KR\boldsymbol{u&#39;}" title="K\boldsymbol{u}=KRR^{T}\boldsymbol{u}=KR\boldsymbol{u&#39;}" /></p>
<p>This method translates normal and tangent velocity BC into the x-y axis-aligned momentum equation. Upon these rotations incorrect <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%5Cboldsymbol%7Bu%27%7D" alt="\boldsymbol{u&#39;}" title="\boldsymbol{u&#39;}" /> can be applied to x-y axis-aligned momentum equations. To fix this problem we can rewrite the momentum equation in its normal and tangential component, i.e. rotate the momentum equation to be</p>
<p><img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?M%5E%7B%27%7D%20%3D%20%5Cbegin%7Bbmatrix%7D%20M_%7Bn%7D%5C%5C%20M_%7Bt%7D%20%5Cend%7Bbmatrix%7D%20%3D%20%5Cbegin%7Bbmatrix%7D%20n_%7Bx%7D%20%26%20n_%7By%7D%5C%5C%20t_%7Bx%7D%20%26%20t_%7By%7D%20%5Cend%7Bbmatrix%7D%20%5Cbegin%7Bbmatrix%7D%20M_%7Bx%7D%5C%5C%20M_%7By%7D%20%5Cend%7Bbmatrix%7D%20%3D%20R%5E%7BT%7DM" alt="M^{&#39;} = \begin{bmatrix} M_{n}\\ M_{t} \end{bmatrix} = \begin{bmatrix} n_{x} &amp; n_{y}\\ t_{x} &amp; t_{y} \end{bmatrix} \begin{bmatrix} M_{x}\\ M_{y} \end{bmatrix} = R^{T}M" title="M^{&#39;} = \begin{bmatrix} M_{n}\\ M_{t} \end{bmatrix} = \begin{bmatrix} n_{x} &amp; n_{y}\\ t_{x} &amp; t_{y} \end{bmatrix} \begin{bmatrix} M_{x}\\ M_{y} \end{bmatrix} = R^{T}M" /></p>
<p>Applying these methods of rotating the momentum equation by PRE-MULTIPLYING by <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?R%5E%7BT%7D" alt="R^{T}" title="R^{T}" /> and rewriting PRE-MULTIPLYING <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%5Cboldsymbol%7Bu%27%7D" alt="\boldsymbol{u&#39;}" title="\boldsymbol{u&#39;}" /> by <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?R" alt="R" title="R" />:</p>
<p><img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%5Cbegin%7Bbmatrix%7D%20R%5E%7BT%7DK%20%26%20R%5E%7BT%7DG%5C%5C%20G%5E%7BT%7D%20%26%200%20%5Cend%7Bbmatrix%7D%20%5Cbegin%7Bbmatrix%7D%20R%5Cboldsymbol%7Bu%27%7D%5C%5C%20p%20%5Cend%7Bbmatrix%7D%20%3D%20%5Cbegin%7Bbmatrix%7D%20R%5E%7BT%7D%5Cboldsymbol%7Bf%7D%5C%5C%200%20%5Cend%7Bbmatrix%7D" alt="\begin{bmatrix} R^{T}K &amp; R^{T}G\\ G^{T} &amp; 0 \end{bmatrix} \begin{bmatrix} R\boldsymbol{u&#39;}\\ p \end{bmatrix} = \begin{bmatrix} R^{T}\boldsymbol{f}\\ 0 \end{bmatrix}" title="\begin{bmatrix} R^{T}K &amp; R^{T}G\\ G^{T} &amp; 0 \end{bmatrix} \begin{bmatrix} R\boldsymbol{u&#39;}\\ p \end{bmatrix} = \begin{bmatrix} R^{T}\boldsymbol{f}\\ 0 \end{bmatrix}" /></p>
<p>When can rewrite this so the rotation are only applied to the assembled stiffness matricies and assembled r.h.s vectors. This minimises the changes to the existing code structure because only nodal <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?R" alt="R" title="R" /> need to be calculated for nodes that have dofs not defined in the x-y-z axis. In Underworld's implementation elemental <img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?R" alt="R" title="R" /> are calculated for all nodes belonging to a special set and applied as follows</p>
<p><img style="vertical-align:middle" src="http://latex.codecogs.com/gif.latex?%5Cbegin%7Bbmatrix%7D%20R%5E%7BT%7DKR%20%26%20R%5E%7BT%7DG%5C%5C%20G%5E%7BT%7DR%20%26%200%20%5Cend%7Bbmatrix%7D%20%5Cbegin%7Bbmatrix%7D%20%5Cboldsymbol%7Bu%27%7D%5C%5C%20p%20%5Cend%7Bbmatrix%7D%20%3D%20%5Cbegin%7Bbmatrix%7D%20R%5E%7BT%7D%5Cboldsymbol%7Bf%7D%5C%5C%200%20%5Cend%7Bbmatrix%7D" alt="\begin{bmatrix} R^{T}KR &amp; R^{T}G\\ G^{T}R &amp; 0 \end{bmatrix} \begin{bmatrix} \boldsymbol{u&#39;}\\ p \end{bmatrix} = \begin{bmatrix} R^{T}\boldsymbol{f}\\ 0 \end{bmatrix}" title="\begin{bmatrix} R^{T}KR &amp; R^{T}G\\ G^{T}R &amp; 0 \end{bmatrix} \begin{bmatrix} \boldsymbol{u&#39;}\\ p \end{bmatrix} = \begin{bmatrix} R^{T}\boldsymbol{f}\\ 0 \end{bmatrix}" /></p>
<h2 id="references">References</h2>
<ul>
<li>Engelman et al. THE IMPLEMENTATION OF NORMAL AND/OR TANGENTIAL BOUNDARY CONDITIONS IN FINITE ELEMENT CODES FOR INCOMPRESSIBLE FLUID FLOW, Int. JOURNAL FOR NUMERICAL METHODS IN FLUIDS, VOL. 2, 225-238 (1982)</li>
</ul>
